!function($){$.fn.SimSemSearchForm=function(options){function addTriple(jsonTriples,subjet,predicate,object){var triple={subject:subjet,predicate:predicate,object:object};return jsonTriples.triples.push(triple),jsonTriples}function addInWhere(Json,JsonToWhere){return Json.where.push(JsonToWhere),Json}function addVariable(jsonValues,name,valueUrl){return $.each(valueUrl,function(index,value){var newValue={};newValue[name]=value,jsonValues.values.push(newValue)}),jsonValues}function ExecuteSubmited(formObject){var ifDistinct,Json=(ifDistinct="",settings.addDistinct&&(ifDistinct=" DISTINCT"),{queryType:"SELECT"+ifDistinct,variables:["?this"],where:[],type:"query",prefixes:{rdfs:"http://www.w3.org/2000/01/rdf-schema#",xsd:"http://www.w3.org/2001/XMLSchema#"}}),ArrayLiIndex=[];$(formObject._this).find("ul.componentsListe li.groupe").each(function(i){var data_id=$(this).attr("data-index");ArrayLiIndex[data_id]=ArrayLiIndex.length});var have_queriable_criteres=!1;if($(formObject.components).each(function(i){var next_loop=!1;if(0===this.CriteriaGroup.EndClassWidgetGroup.value_selected.length){var WidgetsNeedValueIds=[TYPE_WIDGET_SEARCH_URI,TYPE_WIDGET_TIME_URI];-1<$.inArray(this.CriteriaGroup.EndClassWidgetGroup.widgetType,WidgetsNeedValueIds)&&(next_loop=!0)}if(next_loop)return!0;have_queriable_criteres=!0;var dependantDe=GetDependantCriteria(formObject,this.index),addStartClass=!0;null!=dependantDe&&"parent"==dependantDe.type?(StartVar=ArrayLiIndex[dependantDe.element.id]+1,0==StartVar&&(StartVar="this"),EndVar=ArrayLiIndex[this.index]+1,addStartClass=!1):(StartVar="this",EndVar=ArrayLiIndex[this.index]+1),null!=dependantDe&&"sibling"==dependantDe.type&&(addStartClass=!1);var StartLabel,EndLabel,start=this.CriteriaGroup.StartClassGroup.value_selected,obj=this.CriteriaGroup.ObjectPropertyGroup.value_selected,end=this.CriteriaGroup.EndClassGroup.value_selected;-1<start.indexOf("#")?StartLabel=(StartLabel=start.split("#"))[1]:StartLabel=(StartLabel=start.split("/"))[StartLabel.length-1];-1<end.indexOf("#")?EndLabel=(EndLabel=end.split("#"))[1]:EndLabel=(EndLabel=end.split("/"))[EndLabel.length-1];"this"!=StartVar&&(StartVar=StartLabel+""+StartVar),EndVar=EndLabel+""+EndVar;var endValueName="?"+EndVar,new_triple={type:"bgp",triples:[]};if(addStartClass&&(new_triple=addTriple(new_triple,"?"+StartVar,settings.typePredicate,start)),_WidgetType=this.CriteriaGroup.EndClassWidgetGroup.widgetType,new_triple=(_WidgetType==TYPE_WIDGET_LIST_URI||_WidgetType==TYPE_WIDGET_AUTOCOMPLETE_URI)&&1==this.CriteriaGroup.EndClassWidgetGroup.value_selected.length?addTriple(new_triple,"?"+StartVar,obj,this.CriteriaGroup.EndClassWidgetGroup.value_selected[0]):addTriple(new_triple,"?"+StartVar,obj,endValueName),this.CriteriaGroup.EndClassWidgetGroup.value_selected.length,Json=addInWhere(Json,new_triple),0<this.CriteriaGroup.EndClassWidgetGroup.value_selected.length){var jsonValue={type:"values",values:[]};switch(_WidgetType){case TYPE_WIDGET_LIST_URI:case TYPE_WIDGET_AUTOCOMPLETE_URI:1<this.CriteriaGroup.EndClassWidgetGroup.value_selected.length&&(jsonValue=addVariable(jsonValue,endValueName,this.CriteriaGroup.EndClassWidgetGroup.value_selected),Json=addInWhere(Json,jsonValue));break;case TYPE_WIDGET_TIME_URI:$.each(this.CriteriaGroup.EndClassWidgetGroup.value_selected,function(index,value){jsonFilter=function(StartYear,EndYear,index){return{type:"filter",expression:{type:"operation",operator:"&&",args:[{type:"operation",operator:">",args:[""+index,'"'+StartYear+'-01-01"^^http://www.w3.org/2001/XMLSchema#dateTime']},{type:"operation",operator:"<=",args:[""+index,'"'+EndYear+'-12-31"^^http://www.w3.org/2001/XMLSchema#dateTime']}]}}}(value.start,value.stop,endValueName),Json=addInWhere(Json,jsonFilter)});break;case TYPE_WIDGET_SEARCH_URI:var Texte=$("#ecgrw-search-"+this.index+"-input-value").val();jsonFilter=function(Texte,index){return{type:"filter",expression:{type:"operation",operator:"regex",args:[""+index,'"'+Texte+'"','"i"']}}}(Texte,endValueName),Json=addInWhere(Json,jsonFilter)}}}),console.log(Json),have_queriable_criteres){var generatedQuery=(new Ngenerator).stringify(Json);settings.onQueryUpdated(generatedQuery,Json)}}function intiGeneralEvent(thisForm_){$("li.groupe").off("mouseover"),$("li.groupe").off("mouseleave"),$("li.groupe").on("mouseover",function(event){event.stopImmediatePropagation(),$("li.groupe").removeClass("Hover"),$(this).addClass("Hover")}),$("li.groupe").on("mouseleave",function(event){event.stopImmediatePropagation(),$("li.groupe").removeClass("Hover")});var $all_li=thisForm_._this.find("li.groupe"),leng=$all_li.length;leng<=10&&(leng=10);var ratio=100/leng/100,prev=0,cssdef="linear-gradient(180deg";$all_li.each(function(index){var a=(index+1)*ratio,height=$(this).find(">div").outerHeight(!0);if(cssdef+=", rgba("+settings.backgroundBaseColor+","+a+") "+prev+"px, rgba("+settings.backgroundBaseColor+","+a+") "+(prev+height)+"px",prev=prev+height+1,console.log($(this).next()),0<$(this).next().length){$(this).addClass("hasAnd");var this_li=$(this),this_link_and=$(this).find(".link-and-bottom");$(this_link_and).height($(this_li).height())}else $(this).removeClass("hasAnd")}),thisForm_._this.find("div.bg-wrapper").css({background:cssdef+")"})}function getClassById(ClassId){var classObject=null;return $.each(specSearch["@graph"],function(key,val){"Class"==val["@type"]&&val["@id"]==ClassId&&(classObject=val)}),classObject}function getClassLabel(ClassId){var classLabel=null,classObject=getClassById(ClassId);return null!==classObject&&$.each(classObject.label,function(key,val){val["@language"]==settings.language&&(classLabel=val["@value"])}),classLabel}function getObjectPropertyById(ObjectPropertyId){var ObjectPropertyObject=null;return $.each(specSearch["@graph"],function(key,val){"ObjectProperty"==val["@type"]&&val["@id"]==ObjectPropertyId&&(ObjectPropertyObject=val)}),ObjectPropertyObject}function getClassListSelectFor(classId,inputID,default_value){var list=[],items=getAllClassFor(classId);return $.each(items,function(key,val){var label=getClassLabel(val["@id"]);val.highlightedIconPath&&0!==val.highlightedIconPath.length||(val.highlightedIconPath=val.iconPath);var image=' data-icon="'+val.iconPath+'" data-iconh="'+val.highlightedIconPath+'"',selected="";default_value==val["@id"]&&(selected='selected="selected"'),list.push('<option value="'+val["@id"]+'" data-id="'+val["@id"]+'"'+image+selected+">"+label+"</option>")}),$("<select/>",{"class":"my-new-list input-val",id:"select-"+inputID,html:list.join("")})}function getObjectListSelectFor(domainClassID,rangeClassID,inputID,default_value){var list=[],items=function(domainClassID,rangeClassID){var items=[];return $.each(specSearch["@graph"],function(key,val){if(null!==domainClassID)var haveDomain=objectPropertyhaveClassLink(val,"domain",domainClassID);else haveDomain=!0;if(null!==rangeClassID)var haveRange=objectPropertyhaveClassLink(val,"range",rangeClassID);else haveRange=!0;haveDomain&&haveRange&&(items=pushIfNotInArray(val,items))}),items}(domainClassID,rangeClassID);return $.each(items,function(key,val){var label=function(graphItemID){var label="";return $.each(graphItemID.label,function(key,val){val["@language"]==settings.language&&(label=val["@value"])}),label}(val),selected="";default_value==val["@id"]&&(selected='selected="selected"'),list.push('<option value="'+val["@id"]+'" data-id="'+val["@id"]+'"'+selected+">"+label+"</option>")}),$("<select/>",{"class":"select-list input-val",id:inputID,html:list.join("")})}function classIsInDomain(ObjectPropertyId,ClassId){var classIsDomain=!1;return $.each(specSearch["@graph"],function(key,val){"ObjectProperty"==val["@type"]&&val["@id"]==ObjectPropertyId&&("object"===$.type(val.domain)?$.each(val.domain.unionOf["@list"],function(domkey,domval){domval["@id"]==ClassId&&(classIsDomain=!0)}):val.domain==ClassId&&(classIsDomain=!0))}),classIsDomain}function getAllClassFor(ClassID){var items=[];return $searchKey="range",null===ClassID&&($searchKey="domain"),$.each(specSearch["@graph"],function(key,val){if("ObjectProperty"==val["@type"])if("object"===$.type(val[$searchKey]))$.each(val[$searchKey].unionOf["@list"],function(domkey,domval){if(null===ClassID){var item=getClassById(domval["@id"]);items=pushIfNotInArray(item,items)}else if(classIsInDomain(val["@id"],ClassID)){item=getClassById(domval["@id"]);items=pushIfNotInArray(item,items)}});else if(null===ClassID){var item=getClassById(val[$searchKey]);items=pushIfNotInArray(item,items)}else if(classIsInDomain(val["@id"],ClassID)){item=getClassById(val[$searchKey]);items=pushIfNotInArray(item,items)}}),items}function objectPropertyhaveClassLink(graphItem,type,ClassID){var ifHave=!1;return"ObjectProperty"==graphItem["@type"]&&("object"===$.type(graphItem[type])?$.each(graphItem[type].unionOf["@list"],function(domkey,domval){domval["@id"]==ClassID&&(ifHave=!0)}):graphItem[type]==ClassID&&(ifHave=!0)),ifHave}function pushIfNotInArray(item,items){return $.inArray(item,items)<0&&items.push(item),items}function addComponent(thisForm_,contexte){if(0<thisForm_.components.length)var new_index=thisForm_.components[thisForm_.components.length-1].index+1;else new_index=0;var classWherePossible="addWereEnable";$(contexte).parents("li.groupe").length+1==settings.maxDepth-1&&(classWherePossible="addWereDisable");var gabari='<li class="groupe" data-index="'+new_index+'"><span class="link-and-bottom"><span>'+langSearch.And+'</span></span><span class="link-where-bottom"></span><input name="a-'+new_index+'" type="hidden" value=""><input name="b-'+new_index+'" type="hidden" value=""><input name="c-'+new_index+'" type="hidden" value=""></li>';if($(contexte).is("li")){if(0==$(contexte).find(">ul").length){var ul=$('<ul class="childsList"><div class="lien-top"><span>'+langSearch.Where+"</span></div></ul>").appendTo($(contexte)),parent_li=$(ul).parent("li"),n_width=0;n_width=n_width+GetOffSet($(parent_li).find(">div>.EndClassGroup"),$(ul))-111+15+11+20+5+3;var t_width=GetOffSet($(parent_li).find(">div>.EndClassGroup"),$(ul))+15+11+20+5;$(ul).attr("data-test",GetOffSet($(parent_li).find(">div>.EndClassGroup"),$(ul))),$(ul).find(">.lien-top").css("width",n_width),$(parent_li).find(">.link-where-bottom").css("left",t_width)}else ul=$(contexte).find(">ul");gabari=$(gabari).appendTo(ul)}else gabari=$(gabari).appendTo(contexte);$(gabari).addClass(classWherePossible);var UnCritere=new function(context){(this._this=this).thisForm_=context.FormContext,this.ParentComponent=context.FormContext,this.ComponentHtml=context.HtmlContext,this.AncestorComponentHtml=context.AncestorHtmlContext,this.statements={HasAllComplete:!1,IsOnEdit:!1},this.id=context.ContextComponentIndex,this.html=$('<div id="CriteriaGroup-'+this.id+'" class="CriteriaGroup"></div>').appendTo(this.ComponentHtml),this.Context=new function(context){this.contexteReference=context,this.hasContext=!1,null!==context&&(this.hasContext=!0);this.get=function(){return this.contexteReference}}(context),this.ChildrensCriteriaGroup=new function(){this.childrensReferences=[],this.get=function(){return this.contexteReferences},this.add=function(children){this.childrensReferences.push(children)}},this.StartClassGroup=new StartClassGroup(this),this.ObjectPropertyGroup=new ObjectPropertyGroup(this),this.EndClassGroup=new EndClassGroup(this),this.EndClassWidgetGroup=new EndClassWidgetGroup(this),this.ActionsGroup=new ActionsGroup(this),$(this).trigger({type:"Created"}),this.initEnd=function(){$(this).trigger({type:"StartClassGroupSelected"})},this.initCompleted=function(){$(this.html).parent("li").addClass("completed")},this.RemoveCriteria=function(){console.log(this);var index_to_remove=this.id;$(this.ParentComponent.components).each(function(){var dependantDe=GetDependantCriteria(this.CriteriaGroup.thisForm_,this.index);null!=dependantDe&&"parent"==dependantDe.type&&dependantDe.element.id==index_to_remove&&this.CriteriaGroup.RemoveCriteria()});var dependantDe=GetDependantCriteria(this.thisForm_,this.id);if(null===dependantDe);else var dependantComponent=dependantDe.element;var formObject=this.thisForm_,formContextHtml=this.Context.contexteReference.AncestorHtmlContext;this.ComponentHtml.outerHTML=this.ComponentHtml.outerHTML,$(this.ComponentHtml).remove();var iteration_to_remove=!1;if($(this.ParentComponent.components).each(function(i){this.index==index_to_remove&&(iteration_to_remove=i)}),this.ParentComponent.components.splice(iteration_to_remove,1),0==this.ParentComponent.components.length){console.log(formObject);var new_component=addComponent(formObject,formContextHtml);$(new_component).find(".nice-select").trigger("click")}else null!==dependantDe&&(0<$(dependantComponent.ComponentHtml).find("li.groupe").length||($(dependantComponent.ComponentHtml).hasClass("haveWhereChild")&&($(dependantComponent.ComponentHtml).removeClass("haveWhereChild"),$(dependantComponent.ComponentHtml).removeClass("completed")),$(dependantComponent.ComponentHtml).find(">ul.childsList").remove())),intiGeneralEvent(formObject),ExecuteSubmited(formObject);return!1}}({AncestorHtmlContext:contexte,HtmlContext:gabari,FormContext:thisForm_,ContextComponentIndex:new_index});return thisForm_.components.push({index:new_index,CriteriaGroup:UnCritere}),intiGeneralEvent(thisForm_),$(gabari)}function GetOffSet(elem,elemParent){return elem.offset().left-$(elemParent).offset().left}function eventProxiCriteria(e){e.data.arg1[e.data.arg2]()}function ActionsGroup(CriteriaGroupe){this.base=GroupContenaire,this.base(),this.ParentComponent=CriteriaGroupe,this.GroupType="ActionsGroup",this.statements.ActionsGroup=!0,this.statements.Created=!1,this.hasSubvalues=!0,this.detectWidgetType=function(){this.widgetType="Actions"},this.InputTypeComponent={ActionWhere:new ActionWhere(this),ActionAnd:new ActionAnd(this),ActionRemove:new ActionRemove(this)},$(CriteriaGroupe).on("Created",function(){this.ActionsGroup.detectWidgetType(),this.ActionsGroup.InputTypeComponent.ActionRemove.init(),$(this.ActionsGroup.InputTypeComponent.ActionRemove.html).find("a").on("click",{arg1:this,arg2:"RemoveCriteria"},eventProxiCriteria)}),$(CriteriaGroupe).on("ObjectPropertyGroupSelected",function(){this.ActionsGroup.detectWidgetType(),this.ActionsGroup.InputTypeComponent.ActionWhere.HtmlContainer.html=$(this.EndClassGroup.html).find(".EditComponents"),this.ActionsGroup.InputTypeComponent.ActionWhere.init(),this.ActionsGroup.InputTypeComponent.ActionAnd.init(),$(this.ActionsGroup.InputTypeComponent.ActionWhere.html).find("a").on("click",{arg1:this.ActionsGroup,arg2:"AddWhere"},eventProxiCriteria),$(this.ActionsGroup.InputTypeComponent.ActionAnd.html).find("a").on("click",{arg1:this.ActionsGroup,arg2:"AddAnd"},eventProxiCriteria),intiGeneralEvent(this.thisForm_)}),this.AddWhere=function(){this.ParentComponent.html.parent("li").addClass("haveWhereChild"),this.ParentComponent.initCompleted();var new_component=addComponent(this.ParentComponent.thisForm_,this.ParentComponent.Context.contexteReference.HtmlContext);$(new_component).find(".nice-select").trigger("click"),$(new_component).find(".nice-select").trigger("click")},this.AddAnd=function(){var new_component=addComponent(this.ParentComponent.thisForm_,this.ParentComponent.Context.contexteReference.AncestorHtmlContext);return $(new_component).find(".nice-select").trigger("click"),$(new_component).find(".nice-select").trigger("click"),!1},this.validSelected=function(){},this.init()}function ActionWhere(GroupContenaire){this.base=InputTypeComponent,this.base(),this.ParentComponent=GroupContenaire,this.statements.ActionWhere=!0,this.statements.ShowOnHover=!0,this.statements.Created=!1,this.HtmlContainer={}}function ActionAnd(GroupContenaire){this.base=InputTypeComponent,this.base(),this.ParentComponent=GroupContenaire,this.statements.ActionAnd=!0,this.statements.ShowOnHover=!0,this.statements.Created=!1,this.HtmlContainer=this.ParentComponent}function ActionRemove(GroupContenaire){this.base=InputTypeComponent,this.base(),this.ParentComponent=GroupContenaire,this.statements.ActionRemove=!0,this.statements.Created=!1,this.HtmlContainer=this.ParentComponent}function ObjectPropertyTypeWidget(GroupContenaire){this.base=InputTypeComponent,this.base(),this.ParentComponent=GroupContenaire,this.html='<div class="ObjectPropertyTypeWidget"></div>',this.widgetHtml=null,this.widgetType=null,this.HtmlContainer=this.ParentComponent,this.statements.Created=!1,console.log(this),this.init=function(){if(console.log(this),this.ParentComponent instanceof EndClassWidgetGroup){if(this.statements.Created)return this.tools.Update(),!0;this.ParentComponent.ParentComponent.StartClassGroup;var endClassGroup=this.ParentComponent.ParentComponent.EndClassGroup;if(console.log(endClassGroup),endClassGroup.value_selected==LABEL_URI)var endLabel=getClassLabel(endClassGroup.value_selected);else endLabel=langSearch.Find+" "+getClassLabel(endClassGroup.value_selected);var widgetLabel='<span class="edit-trait first"><span class="edit-trait-top"></span><span class="edit-num">1</span></span>'+endLabel;this.widgetType=this.ParentComponent.widgetType,this.getWigetTypeClassName(),this.widgetHtml=widgetLabel+this.widgetComponent.html,this.statements.IsOnEdit=!0,this.tools=new GenericTools(this),this.tools.InitHtml(),this.tools.Add(),this.widgetComponent.init(),this.statements.Created=!0}},this.getWigetTypeClassName=function(){switch(this.widgetType){case TYPE_WIDGET_LIST_URI:this.widgetComponent=new function(InputTypeComponent){this.base=widgetType,this.base(),this.ParentComponent=InputTypeComponent,this.ParentComponent.statements.ListeWidget=!0,this.IdCriteriaGroupe=this.ParentComponent.ParentComponent.ParentComponent.id;var id_input="ecgrw-"+this.IdCriteriaGroupe+"-input-value";this.html='<div class="list-widget"><select id="'+id_input+'"></select></div>',this.select=$('<select id="'+id_input+'"></select>'),this.init=function(){var startClassGroup_value=this.ParentComponent.ParentComponent.ParentComponent.StartClassGroup.value_selected,endClassGroup_value=this.ParentComponent.ParentComponent.ParentComponent.EndClassGroup.value_selected,ObjectPropertyGroup_value=this.ParentComponent.ParentComponent.ParentComponent.ObjectPropertyGroup.value_selected,itc_obj=this.ParentComponent,options={url:settings.listUrl(startClassGroup_value,ObjectPropertyGroup_value,endClassGroup_value),dataType:"json",method:"GET",data:{dataType:"json"}},request=$.ajax(options);$(this.html).find("select"),request.done(function(data){$.each(data,function(key,val){$("#"+id_input).append("<option value='"+val.uri+"'>"+val.label+"</option>")}),$("#"+id_input).niceSelect(),$("#"+id_input).on("change",function(){$(itc_obj).trigger("change")})})}}(this);break;case TYPE_WIDGET_AUTOCOMPLETE_URI:this.widgetComponent=new function(InputTypeComponent){this.base=widgetType,this.base(),this.ParentComponent=InputTypeComponent,this.ParentComponent.statements.AutocompleteWidget=!0,this.IdCriteriaGroupe=this.ParentComponent.ParentComponent.ParentComponent.id,this.html='<input id="ecgrw-'+this.IdCriteriaGroupe+'-input" /><input id="ecgrw-'+this.IdCriteriaGroupe+'-input-value" type="hidden"/>',this.init=function(){var startClassGroup_value=this.ParentComponent.ParentComponent.ParentComponent.StartClassGroup.value_selected,endClassGroup_value=this.ParentComponent.ParentComponent.ParentComponent.EndClassGroup.value_selected,ObjectPropertyGroup_value=this.ParentComponent.ParentComponent.ParentComponent.ObjectPropertyGroup.value_selected,id_inputs=this.IdCriteriaGroupe,itc_obj=this.ParentComponent,options={ajaxSettings:{crossDomain:!0,type:"GET"},url:function(phrase){return settings.autocompleteUrl(startClassGroup_value,ObjectPropertyGroup_value,endClassGroup_value,phrase)},getValue:function(element){return element.label},ajaxSettings:{dataType:"json",method:"GET",data:{dataType:"json"}},preparePostData:function(data){return data.phrase=$("#ecgrw-"+id_inputs+"-input").val(),data},list:{onChooseEvent:function(){var value=$("#ecgrw-"+id_inputs+"-input").getSelectedItemData();$("#ecgrw-"+id_inputs+"-input").val(value.label),$("#ecgrw-"+id_inputs+"-input-value").val(value.uri).trigger("change"),$(itc_obj).trigger("change")}},requestDelay:400};$("#ecgrw-"+id_inputs+"-input").easyAutocomplete(options)}}(this);break;case TYPE_WIDGET_TIME_URI:this.widgetComponent=new function(InputTypeComponent){this.base=widgetType,this.base(),this.ParentComponent=InputTypeComponent,this.ParentComponent.statements.DatesWidget=!0,this.IdCriteriaGroupe=this.ParentComponent.ParentComponent.ParentComponent.id,this.html='<div class="date-widget"><input id="ecgrw-date-'+this.IdCriteriaGroupe+'-input" placeholder="'+langSearch.PlaceHolderDatePeriod+'" /><input id="ecgrw-date-'+this.IdCriteriaGroupe+'-input-start" placeholder="'+langSearch.PlaceHolderDateFrom+'"/><input id="ecgrw-date-'+this.IdCriteriaGroupe+'-input-stop" placeholder="'+langSearch.PlaceHolderDateTo+'" /><input id="ecgrw-date-'+this.IdCriteriaGroupe+'-input-value" type="hidden"/><button class="button-add" id="ecgrw-date-'+this.IdCriteriaGroupe+'-add">'+langSearch.ButtonAdd+"</button></div>",this.init=function(){var startClassGroup_value=this.ParentComponent.ParentComponent.ParentComponent.StartClassGroup.value_selected,endClassGroup_value=this.ParentComponent.ParentComponent.ParentComponent.EndClassGroup.value_selected,ObjectPropertyGroup_value=this.ParentComponent.ParentComponent.ParentComponent.ObjectPropertyGroup.value_selected,data_json=null,id_inputs=this.IdCriteriaGroupe,itc_obj=this.ParentComponent;$.ajax({url:settings.datesUrl(startClassGroup_value,ObjectPropertyGroup_value,endClassGroup_value,""),async:!1,success:function(data){data_json=data}});var options={data:data_json,getValue:function(element){return element.label+" "+element.synonyms.join(" ")},list:{match:{enabled:!0},onChooseEvent:function(){var value=$("#ecgrw-date-"+id_inputs+"-input").getSelectedItemData().label,start=$("#ecgrw-date-"+id_inputs+"-input").getSelectedItemData().start.year,stop=$("#ecgrw-date-"+id_inputs+"-input").getSelectedItemData().stop.year;$("#ecgrw-date-"+id_inputs+"-input").val(value).trigger("change"),$("#ecgrw-date-"+id_inputs+"-input-start").val(start).trigger("change"),$("#ecgrw-date-"+id_inputs+"-input-stop").val(stop).trigger("change"),$("#ecgrw-"+id_inputs+"-input-value").val(value).trigger("change")}},template:{type:"custom",method:function(value,item){return"<div>"+item.label+' <span class="start">'+item.start.year+'</span><span class="end">'+item.stop.year+"</span></div>"}},requestDelay:400};$("#ecgrw-date-"+id_inputs+"-input").easyAutocomplete(options),$("#ecgrw-date-"+this.IdCriteriaGroupe+"-add").on("click",function(){$(itc_obj).trigger("change")})}}(this);break;case TYPE_WIDGET_SEARCH_URI:this.widgetComponent=new function(InputTypeComponent){this.base=widgetType,this.base(),this.ParentComponent=InputTypeComponent,this.ParentComponent.statements.SearchWidget=!0,this.IdCriteriaGroupe=this.ParentComponent.ParentComponent.ParentComponent.id,this.html='<div class="search-widget"><input id="ecgrw-search-'+this.IdCriteriaGroupe+'-input-value" /><button id="ecgrw-search-'+this.IdCriteriaGroupe+'-add" class="button-add">'+langSearch.ButtonAdd+"</button></div>",this.init=function(){this.ParentComponent.ParentComponent.ParentComponent.StartClassGroup.value_selected,this.ParentComponent.ParentComponent.ParentComponent.EndClassGroup.value_selected,this.ParentComponent.ParentComponent.ParentComponent.ObjectPropertyGroup.value_selected;var id_inputs=this.IdCriteriaGroupe,itc_obj=this.ParentComponent,EndClassGroupObject=this.ParentComponent.ParentComponent.ParentComponent.EndClassGroup;$("#ecgrw-search-"+this.IdCriteriaGroupe+"-add").on("click",function(){$("#ecgrw-search-"+id_inputs+"-input-value").trigger("change"),$(itc_obj).trigger("change"),$(EndClassGroupObject.html).find(".ClassTypeId").hide()})}}(this)}},this.GetValue=function(){var value_widget=null;switch(this.widgetType){case TYPE_WIDGET_LIST_URI:case TYPE_WIDGET_AUTOCOMPLETE_URI:id_input="#ecgrw-"+this.widgetComponent.IdCriteriaGroupe+"-input-value";value_widget=$(id_input).val(),console.log(value_widget);break;case TYPE_WIDGET_TIME_URI:id_input="#ecgrw-date-"+this.widgetComponent.IdCriteriaGroupe+"-input";""==(value_widget={start:$(id_input+"-start").val(),stop:$(id_input+"-stop").val()}).start||""==value_widget.stop?value_widget=null:parseInt(value_widget.start)>parseInt(value_widget.stop)&&(value_widget=null);break;case TYPE_WIDGET_SEARCH_URI:var id_input="#ecgrw-search-"+this.widgetComponent.IdCriteriaGroupe+"-input-value";value_widget=$(id_input).val()}return value_widget},this.GetValueLabel=function(){var value_widget=null;switch(this.widgetType){case TYPE_WIDGET_LIST_URI:var id_input="#ecgrw-"+this.widgetComponent.IdCriteriaGroupe+"-input-value";value_widget="<span>"+$(id_input).find("option:selected").text()+"</span>";break;case TYPE_WIDGET_AUTOCOMPLETE_URI:id_input="#ecgrw-"+this.widgetComponent.IdCriteriaGroupe+"-input";value_widget="<span>"+$(id_input).val()+"</span>";break;case TYPE_WIDGET_TIME_URI:id_input="#ecgrw-date-"+this.widgetComponent.IdCriteriaGroupe+"-input";value_widget='<span class="label-two-line">De '+$(id_input+"-start").val()+" à "+$(id_input+"-stop").val()+"<br/>("+$(id_input).val()+")</span>";break;case TYPE_WIDGET_SEARCH_URI:id_input="#ecgrw-search-"+this.widgetComponent.IdCriteriaGroupe+"-input-value";value_widget="<span>"+$(id_input).val()+"</span>"}return value_widget}}function widgetType(){this.parentComponent=null,this.html=null}function GenericTools(component){this.component=component,this.component.inserted=!1,this.AppendComponentHtml=function(){this.component.inserted||(this.component.html=$(this.component.html).appendTo(this.component.HtmlContainer.html),this.component.inserted=!0)},this.UpdateStatementsClass=function(){for(var item in this.component.statements)!0===this.component.statements[item]?$(this.component.html).addClass(item):$(this.component.html).removeClass(item)},this.Add=function(){this.UpdateStatementsClass(),this.component.inserted||this.AppendComponentHtml()},this.Update=function(){this.UpdateStatementsClass()},this.InitHtml=function(){var instance=this.component.constructor.name,widget=this.component.widgetHtml;this.component.html=$('<div class="'+instance+' ddd"></div>'),widget&&this.component.html.append(widget)}}var specSearch={},langSearch={},defaults={pathSpecSearch:"config/spec-search.json",pathLanguages:"config/lang/",language:"en",addDistinct:!1,typePredicate:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",maxDepth:3,maxOr:3,backgroundBaseColor:"250,136,3",autocompleteUrl:function(domain,property,range,key){console.log("Veuillez préciser le nom de la fonction pour l'option autocompleteUrl dans les parametre d'initalisation de SimSemSearchForm. La liste des parametres envoyées a votre fonction est la suivante : domain, property, range, key")},listUrl:function(domain,property,range){console.log("Veuillez préciser le nom de la fonction pour l'option listUrl dans les parametre d'initalisation de SimSemSearchForm. La liste des parametres envoyées a votre fonction est la suivante : domain, property, range")},datesUrl:function(domain,property,range,key){console.log("Veuillez préciser le nom de la fonction pour l'option datesUrl dans les parametre d'initalisation de SimSemSearchForm. La liste des parametres envoyées a votre fonction est la suivante : domain, property, range, key")},onQueryUpdated:function(queryString,queryJson){console.log("Veuillez préciser le nom de la fonction pour l'option onQueryUpdated dans les parametre d'initalisation de SimSemSearchForm. Les parêtres envoyés à la fonction contiendront la requête convertie en Sparql et le Json servant à générer la requête")}},TYPE_WIDGET_LIST_URI="http://ontologies.sparna.fr/SimSemSearch#ListWidget",TYPE_WIDGET_TIME_URI="http://ontologies.sparna.fr/SimSemSearch#TimeWidget",TYPE_WIDGET_AUTOCOMPLETE_URI="http://ontologies.sparna.fr/SimSemSearch#AutocompleteWidget",TYPE_WIDGET_SEARCH_URI="http://ontologies.sparna.fr/SimSemSearch#SearchWidget",LABEL_URI="http://www.openarchaeo.fr/explorateur/onto#Label",settings=$.extend({},defaults,options);this.each(function(){var fileName,thisForm={};thisForm._this=$(this),$(this).addClass("SimSemSearch"),thisForm.components=[],$.when($.getJSON(settings.pathSpecSearch,function(data){specSearch=data}).fail(function(response){console.log("SimSemSearch - unable to load config file : "+settings.pathSpecSearch),console.log(response)})&&(fileName=settings.language+".json",$.getJSON(settings.pathLanguages+fileName,function(data){langSearch=data}).fail(function(response){console.log("SimSemSearch - unable to load lang file : "+settings.pathLanguages+fileName),console.log(response)}))).done(function(){var thisForm_,contexte;thisForm_=thisForm,contexte=$('<div class="bg-wrapper"><ul class="componentsListe"></ul></div>'),$(thisForm_._this).append(contexte),contexte1=addComponent(thisForm_,contexte.find("ul")),$(thisForm_._this).find(".nice-select").trigger("click"),intiGeneralEvent(thisForm_),$(thisForm_._this).on("submit",{formObject:thisForm_},function(event){event.preventDefault(),ExecuteSubmited(event.data.formObject)})})});var GroupContenaire=function(){this.ParentComponent=null,this.GroupType=null,this.hasSubvalues=!1,this.InputTypeComponent=null,this.tools=null,this.widgetHtml=!1,this.html=$(),this.statements={HasInputsCompleted:!1,IsOnEdit:!1},this.init=function(){this.statements.Created?this.tools.Update():(this.statements.IsOnEdit=!0,this.HtmlContainer=this.ParentComponent,this.tools=new GenericTools(this),this.tools.InitHtml(),this.tools.Add(),this.statements.Created=!0)},this.Edit=function(){this.InputTypeComponent.statements.IsOnEdit=!0}},StartClassGroup=function(CriteriaGroupe){this.base=GroupContenaire,this.base(),this.ParentComponent=CriteriaGroupe,this.GroupType="StartClassGroup",this.statements.StartClassGroup=!0,this.statements.Created=!1,this.InputTypeComponent=new ClassTypeId(this),$(CriteriaGroupe).on("Created",function(){$(this.StartClassGroup.html).find(".input-val").unbind("change"),this.StartClassGroup.InputTypeComponent.init(),this.StartClassGroup.Edit();var select=$(this.StartClassGroup.html).find(".input-val");if(this.StartClassGroup.niceslect=$(select).niceSelect(),$(this.StartClassGroup.html).find("select.input-val").on("change",{arg1:this.StartClassGroup,arg2:"validSelected"},eventProxiCriteria),$(this.Context.get().AncestorHtmlContext).is("li"))parseInt($(this.Context.get().AncestorHtmlContext).attr("data-index"))}),this.validSelected=function(){this.value_selected=$(this.html).find("select.input-val").val(),$(this.ParentComponent.StartClassGroup.html).find(".input-val").attr("disabled","disabled").niceSelect("update"),$(this.ParentComponent).trigger({type:"StartClassGroupSelected"})},this.init()},ObjectPropertyGroup=function(CriteriaGroupe1){this.base=GroupContenaire,this.base(),this.ParentComponent=CriteriaGroupe1,this.GroupType="ObjectPropertyGroup",this.statements.ObjectPropertyGroup=!0,this.statements.Created=!1,this.hasSubvalues=!0,this.InputTypeComponent=new function(GroupContenaire){this.base=InputTypeComponent,this.base(),this.ParentComponent=GroupContenaire,this.html='<div class="ObjectPropertyTypeId"></div>',this.widgetHtml=null,this.HtmlContainer=this.ParentComponent,this.statements.Created=!1}(this),$(CriteriaGroupe1).on("EndClassGroupSelected",function(){$(this.ObjectPropertyGroup.html).find(".input-val").unbind("change"),this.ObjectPropertyGroup.InputTypeComponent.init(),this.ObjectPropertyGroup.Edit(),this.ObjectPropertyGroup.niceslect=$(this.ObjectPropertyGroup.html).find("select.input-val").niceSelect(),$(this.ObjectPropertyGroup.html).find(".nice-select").trigger("click"),$(this.ObjectPropertyGroup.html).find("select.input-val").on("change",{arg1:this.ObjectPropertyGroup,arg2:"validSelected"},eventProxiCriteria),1==$(this.ObjectPropertyGroup.html).find("select.input-val").find("option").length&&$(this.ObjectPropertyGroup.html).find(".nice-select").trigger("click")}),this.validSelected=function(){this.value_selected=$(this.html).find("select.input-val").val(),$(this.ParentComponent.ObjectPropertyGroup.html).find(".input-val").attr("disabled","disabled").niceSelect("update"),$(this.ParentComponent).trigger({type:"ObjectPropertyGroupSelected"});var objSpec=getObjectPropertyById(this.value_selected);objSpec.widget["@type"]==TYPE_WIDGET_SEARCH_URI||objSpec.widget["@type"],$(this.ParentComponent.thisForm_._this).trigger({type:"submit"})},this.init()},EndClassGroup=function(CriteriaGroupe){this.base=GroupContenaire,this.base(),this.ParentComponent=CriteriaGroupe,this.GroupType="EndClassGroup",this.statements.EndClassGroup=!0,this.statements.Created=!1,this.hasSubvalues=!0,this.InputTypeComponent=new ClassTypeId(this),$(CriteriaGroupe).on("StartClassGroupSelected",function(){$(this.EndClassGroup.html).find(".input-val").unbind("change"),$(this.EndClassGroup.html).append('<div class="EditComponents ShowOnHover"></div>'),this.EndClassGroup.InputTypeComponent.init(),this.EndClassGroup.Edit(),this.EndClassGroup.niceslect=$(this.EndClassGroup.html).find("select.input-val").niceSelect(),$(this.EndClassGroup.html).find(".nice-select").trigger("click"),$(this.EndClassGroup.html).find("select.input-val").on("change",{arg1:this.EndClassGroup,arg2:"validSelected"},eventProxiCriteria)}),this.validSelected=function(){this.value_selected=$(this.html).find("select.input-val").val(),$(this.ParentComponent.EndClassGroup.html).find(".input-val").attr("disabled","disabled").niceSelect("update"),0<getAllClassFor(this.value_selected).length?$(this.ParentComponent.html).parent("li").removeClass("WhereImpossible"):$(this.ParentComponent.html).parent("li").addClass("WhereImpossible"),$(this.ParentComponent).trigger({type:"EndClassGroupSelected"})},this.init()},EndClassWidgetGroup=function(CriteriaGroupe){this.base=GroupContenaire,this.base(),this.ParentComponent=CriteriaGroupe,this.GroupType="EndClassWidgetGroup",this.statements.EndClassWidgetGroup=!0,this.statements.Created=!1,this.hasSubvalues=!0,this.value_selected=[],this.detectWidgetType=function(){this.objectPropertyDefinition=getObjectPropertyById(this.ParentComponent.ObjectPropertyGroup.value_selected),this.widgetType=this.objectPropertyDefinition.widget["@type"]},this.InputTypeComponent=new ObjectPropertyTypeWidget(this),$(CriteriaGroupe).on("ObjectPropertyGroupSelected",function(){this.EndClassWidgetGroup.detectWidgetType(),this.EndClassWidgetGroup.InputTypeComponent.HtmlContainer.html=$(this.EndClassGroup.html).find(".EditComponents"),this.EndClassWidgetGroup.InputTypeComponent.init(),$(this.EndClassWidgetGroup.InputTypeComponent).on("change",{arg1:this.EndClassWidgetGroup,arg2:"validSelected"},eventProxiCriteria)}),this.validSelected=function(){var temp_value=this.InputTypeComponent.GetValue();return null!=temp_value&&!(0<this.value_selected.length&&1==Object.onArray(this.value_selected,temp_value))&&(this.value_selected.push(this.InputTypeComponent.GetValue()),this.LabelValueSelected=this.InputTypeComponent.GetValueLabel(),0==$(this.ParentComponent.html).find(".EndClassWidgetGroup>div").length?$(this.ParentComponent.html).find(".EndClassWidgetGroup").append('<div class="EndClassWidgetValue"><span class="triangle-h"></span><span class="triangle-b"></span><p>'+this.LabelValueSelected+"</p></div>"):$(this.ParentComponent.html).find(".EndClassWidgetGroup >.EndClassWidgetAddOrValue").before('<div class="EndClassWidgetValue"><span class="triangle-h"></span><span class="triangle-b"></span><p>'+this.LabelValueSelected+"</p></div>"),$(this.ParentComponent.html).parent("li").addClass("WhereImpossible"),this.ParentComponent.initCompleted(),$(this.ParentComponent).trigger({type:"EndClassWidgetGroupSelected"}),$(this.ParentComponent.thisForm_._this).trigger({type:"submit"}),this.InputTypeComponent.widgetType!=TYPE_WIDGET_LIST_URI&&this.InputTypeComponent.widgetType!=TYPE_WIDGET_AUTOCOMPLETE_URI||1==$(this.ParentComponent.html).find(".EndClassWidgetGroup>div").length&&($(this.ParentComponent.html).find(".EndClassWidgetGroup").append('<div class="EndClassWidgetAddOrValue"><span class="triangle-h"></span><span class="triangle-b"></span><p><span>+</span></p></div>'),$(this.ParentComponent.html).find(".EndClassWidgetGroup>.EndClassWidgetAddOrValue").on("click",{arg1:this,arg2:"needAddOrValue"},eventProxiCriteria)),this.value_selected.length==settings.maxOr&&$(this.ParentComponent.html).find(".EndClassWidgetGroup .EndClassWidgetAddOrValue").hide(),$(this.ParentComponent.html).find(".EndClassGroup>.EditComponents").removeClass("newOr"),void intiGeneralEvent(this.ParentComponent.thisForm_))},this.needAddOrValue=function(){$(this.ParentComponent.html).find(".EndClassGroup>.EditComponents").addClass("newOr")},this.init()},GetDependantCriteria=function(thisForm_,id){var dependant=null,dep_id=null,element=thisForm_._this.find('li[data-index="'+id+'"]');return 0<$(element).parents("li").length?(dep_id=$($(element).parents("li")[0]).attr("data-index"),dependant={type:"parent"}):0<$(element).prev().length&&(dep_id=$(element).prev().attr("data-index"),dependant={type:"sibling"}),$(thisForm_.components).each(function(index){this.index==dep_id&&(dependant.element=this.CriteriaGroup)}),dependant},InputTypeComponent=function(){this.ParentComponent=null,this.statements={IsCompleted:!1,IsOnEdit:!1},this.possibleValue,this.tools=null,this.value=null,this.init=function(){if(this.statements.Created)return this.tools.Update(),!0;var possible_values=null,default_value=null,id=this.ParentComponent.ParentComponent.id;if(this.ParentComponent instanceof StartClassGroup){var dep_element=GetDependantCriteria(this.ParentComponent.ParentComponent.thisForm_,id);dep_element?(default_value="parent"==dep_element.type?dep_element.element.EndClassGroup.value_selected:dep_element.element.StartClassGroup.value_selected,this.statements.Highlited=!1):this.statements.Highlited=!0,possible_values=getClassListSelectFor(null,"a-"+id,default_value)}this.ParentComponent instanceof EndClassGroup&&(possible_values=getClassListSelectFor((startClassGroup=this.ParentComponent.ParentComponent.StartClassGroup).value_selected,"b-"+id));if(this.ParentComponent instanceof ObjectPropertyGroup){var startClassGroup=this.ParentComponent.ParentComponent.StartClassGroup,endClassGroup=this.ParentComponent.ParentComponent.EndClassGroup;possible_values=getObjectListSelectFor(startClassGroup.value_selected,endClassGroup.value_selected,"c-"+id)}if(this.ParentComponent instanceof ActionsGroup){if(this instanceof ActionWhere){var endLabel=getClassLabel((endClassGroup=this.ParentComponent.ParentComponent.EndClassGroup).value_selected);possible_values='<span class="edit-trait"><span class="edit-num">2</span></span>'+langSearch.Search+" "+endLabel+" "+langSearch.That+"..."+"<a>+</a>"}this instanceof ActionAnd&&(possible_values='<span class="trait-and-bottom"></span><a>'+langSearch.And+"</a>"),this instanceof ActionRemove&&(possible_values='<a><img src="assets/icons/buttons/remove.png"></a>')}this.widgetHtml=possible_values,this.statements.IsOnEdit=!0,this.tools=new GenericTools(this),this.tools.InitHtml(),this.tools.Add(),this.statements.Created=!0}},ClassTypeId=function(GroupContenaire){this.base=InputTypeComponent,this.base(),this.ParentComponent=GroupContenaire,this.HtmlContainer=this.ParentComponent,this.statements.Highlited=!0,this.statements.Created=!1};return this},Object.onArray=function(arrayTosearch,objectTocompare){objectTocompare=objectTocompare;var temp_return=!1;return $.each(arrayTosearch,function(key,val){Object.compare(val,objectTocompare)&&(temp_return=!0)}),temp_return},Object.compare=function(obj1,obj2){for(var p in obj1){if(obj1.hasOwnProperty(p)!==obj2.hasOwnProperty(p))return!1;switch(typeof obj1[p]){case"object":if(!Object.compare(obj1[p],obj2[p]))return!1;break;case"function":if("undefined"==typeof obj2[p]||"compare"!=p&&obj1[p].toString()!=obj2[p].toString())return!1;break;default:if(obj1[p]!=obj2[p])return!1}}for(var p in obj2)if("undefined"==typeof obj1[p])return!1;return!0}}(jQuery),function($){$.fn.niceSelect=function(method){function create_nice_select($select){$select.after($("<div></div>").addClass("nice-select").addClass($select.attr("class")||"").addClass($select.attr("disabled")?"disabled":"").attr("tabindex",$select.attr("disabled")?null:"0").html('<span class="current"></span><ul class="list"></ul>'));var $dropdown=$select.next(),$options=$select.find("option"),$selected=$select.find("option:selected"),icon="";$selected.attr("data-icon")!==undefined&&(icon=0==$selected.attr("data-icon").indexOf("<")?$selected.attr("data-icon")+"&nbsp;&nbsp;":'<img src="'+$selected.attr("data-icon")+'" /><img class="highlited" src="'+$selected.attr("data-iconh")+'" />'),$dropdown.find(".current").html($selected.data("display")||icon+$selected.html()),$options.each(function(i){var $option=$(this),display=$option.data("display"),icon="";$option.attr("data-icon")!==undefined&&(icon=0==$option.attr("data-icon").indexOf("<")?$option.attr("data-icon")+"&nbsp;&nbsp;":'<img src="'+$option.attr("data-icon")+'" /><img class="highlited" src="'+$option.attr("data-iconh")+'" />'),$dropdown.find("ul").append($("<li></li>").attr("data-value",$option.val()).attr("data-display",display||null).addClass("option"+($option.is(":selected")?" selected":"")+($option.is(":disabled")?" disabled":"")).html(icon+$option.text()))})}if("string"==typeof method)return"update"==method?this.each(function(){var $select=$(this),$dropdown=$(this).next(".nice-select"),open=$dropdown.hasClass("open");$dropdown.length&&($dropdown.remove(),create_nice_select($select),open&&$select.next().trigger("click"))}):"destroy"==method?(this.each(function(){var $select=$(this),$dropdown=$(this).next(".nice-select");$dropdown.length&&($dropdown.remove(),$select.css("display",""))}),0==$(".nice-select").length&&$(document).off(".nice_select")):console.log('Method "'+method+'" does not exist.'),this;this.hide(),this.each(function(){var $select=$(this);$select.next().hasClass("nice-select")||create_nice_select($select)}),$(document).off(".nice_select"),$(document).on("click.nice_select",".nice-select",function(event){var $dropdown=$(this);$dropdown.hasClass("open")?($dropdown.toggleClass("open"),$dropdown.prev("select").val($dropdown.find(".selected").data("value")).trigger("change")):($(".nice-select").not($dropdown).removeClass("open"),$dropdown.toggleClass("open")),$dropdown.hasClass("open")?($dropdown.find(".option"),$dropdown.find(".focus").removeClass("focus"),$dropdown.find(".selected").addClass("focus")):$dropdown.focus()}),$(document).on("click.nice_select",".nice-select .option:not(.disabled)",function(event){var $option=$(this),$dropdown=$option.closest(".nice-select");$dropdown.find(".selected").removeClass("selected"),$option.addClass("selected");var text=$option.data("display")||$option.html();$dropdown.find(".current").html(text)}),$(document).on("keydown.nice_select",".nice-select",function(event){var $dropdown=$(this),$focused_option=$($dropdown.find(".focus")||$dropdown.find(".list .option.selected"));if(32==event.keyCode||13==event.keyCode)return $dropdown.hasClass("open")?$focused_option.trigger("click"):$dropdown.trigger("click"),!1;if(40==event.keyCode){if($dropdown.hasClass("open")){var $next=$focused_option.nextAll(".option:not(.disabled)").first();0<$next.length&&($dropdown.find(".focus").removeClass("focus"),$next.addClass("focus"))}else $dropdown.trigger("click");return!1}if(38==event.keyCode){if($dropdown.hasClass("open")){var $prev=$focused_option.prevAll(".option:not(.disabled)").first();0<$prev.length&&($dropdown.find(".focus").removeClass("focus"),$prev.addClass("focus"))}else $dropdown.trigger("click");return!1}if(27==event.keyCode)$dropdown.hasClass("open")&&$dropdown.trigger("click");else if(9==event.keyCode&&$dropdown.hasClass("open"))return!1});var style=document.createElement("a").style;return style.cssText="pointer-events:auto","auto"!==style.pointerEvents&&$("html").addClass("no-csspointerevents"),this}}(jQuery);var EasyAutocomplete=function(scope){return scope.main=function($input,options){function init(){0!==$field.length?config.checkDataUrlProperties()?config.checkRequiredProperties()?(prepareField(),function(){function bindKeyup(){$field.off("keyup").keyup(function(event){function loadData(inputPhrase){if(!(inputPhrase.length<config.get("minCharNumber"))){if("list-required"!==config.get("data")){var data=config.get("data"),listBuilders=listBuilderService.init(data);listBuilders=listBuilderService.updateCategories(listBuilders,data),loadElements(listBuilders=listBuilderService.processData(listBuilders,inputPhrase),inputPhrase),0<$field.parent().find("li").length?showContainer():hideContainer()}var settings=function(){var settings={},ajaxSettings=config.get("ajaxSettings")||{};for(var set in ajaxSettings)settings[set]=ajaxSettings[set];return settings}();settings.url!==undefined&&""!==settings.url||(settings.url=config.get("url")),settings.dataType!==undefined&&""!==settings.dataType||(settings.dataType=config.get("dataType")),settings.url!==undefined&&"list-required"!==settings.url&&(settings.url=settings.url(inputPhrase),settings.data=config.get("preparePostData")(settings.data,inputPhrase),$.ajax(settings).done(function(data){var listBuilders=listBuilderService.init(data);listBuilders=listBuilderService.updateCategories(listBuilders,data),listBuilders=listBuilderService.convertXml(listBuilders),function(inputPhrase,data){return!1===config.get("matchResponseProperty")||("string"==typeof config.get("matchResponseProperty")?data[config.get("matchResponseProperty")]===inputPhrase:"function"!=typeof config.get("matchResponseProperty")||config.get("matchResponseProperty")(data)===inputPhrase)}(inputPhrase,data)&&loadElements(listBuilders=listBuilderService.processData(listBuilders,inputPhrase),inputPhrase),listBuilderService.checkIfDataExists(listBuilders)&&0<$field.parent().find("li").length?showContainer():hideContainer(),config.get("ajaxCallback")()}).fail(function(){logger.warning("Fail to load response data")}).always(function(){}))}}switch(event.keyCode){case 27:hideContainer(),$field.trigger("blur");break;case 38:event.preventDefault(),0<elementsList.length&&0<selectedElement&&(selectedElement-=1,$field.val(config.get("getValue")(elementsList[selectedElement])),selectElement(selectedElement));break;case 40:event.preventDefault(),0<elementsList.length&&selectedElement<elementsList.length-1&&(selectedElement+=1,$field.val(config.get("getValue")(elementsList[selectedElement])),selectElement(selectedElement));break;default:if(40<event.keyCode||8===event.keyCode){var inputPhrase=$field.val();!0!==config.get("list").hideOnEmptyPhrase||8!==event.keyCode||""!==inputPhrase?0<config.get("requestDelay")?(requestDelayTimeoutId!==undefined&&clearTimeout(requestDelayTimeoutId),requestDelayTimeoutId=setTimeout(function(){loadData(inputPhrase)},config.get("requestDelay"))):loadData(inputPhrase):hideContainer()}}})}!function(){checkParam("autocompleteOff",!0)&&$field.attr("autocomplete","off");$field.focusout(function(){var phrase,fieldValue=$field.val();config.get("list").match.caseSensitive||(fieldValue=fieldValue.toLowerCase());for(var i=0,length=elementsList.length;i<length;i+=1)if(phrase=config.get("getValue")(elementsList[i]),config.get("list").match.caseSensitive||(phrase=phrase.toLowerCase()),phrase===fieldValue)return void selectElement(selectedElement=i)}),bindKeyup(),$field.on("keydown",function(evt){var keyCode=(evt=evt||window.event).keyCode;if(38===keyCode)return!(suppressKeypress=!0)}).keydown(function(event){13===event.keyCode&&-1<selectedElement&&($field.val(config.get("getValue")(elementsList[selectedElement])),config.get("list").onKeyEnterEvent(),config.get("list").onChooseEvent(),selectedElement=-1,hideContainer(),event.preventDefault())}),$field.off("keypress"),$field.focus(function(){""!==$field.val()&&0<elementsList.length&&(selectedElement=-1,showContainer())}),$field.blur(function(){setTimeout(function(){selectedElement=-1,hideContainer()},250)})}()}()):logger.error("Will not work without mentioned properties."):logger.error("One of options variables 'data' or 'url' must be defined."):logger.error("Input field doesn't exist.")}function prepareField(){function highlight(string,phrase){return config.get("highlightPhrase")&&""!==phrase?function(string,phrase){var escapedPhrase=(str=phrase,str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"));var str;return(string+"").replace(new RegExp("("+escapedPhrase+")","gi"),"<b>$1</b>")}(string,phrase):string}var fieldWidth,$wrapper,classes,$elements_container;$field.parent().hasClass(consts.getValue("WRAPPER_CSS_CLASS"))&&($field.next("."+consts.getValue("CONTAINER_CLASS")).remove(),$field.unwrap()),$wrapper=$("<div>"),classes=consts.getValue("WRAPPER_CSS_CLASS"),config.get("theme")&&""!==config.get("theme")&&(classes+=" eac-"+config.get("theme")),config.get("cssClasses")&&""!==config.get("cssClasses")&&(classes+=" "+config.get("cssClasses")),""!==template.getTemplateClass()&&(classes+=" "+template.getTemplateClass()),$wrapper.addClass(classes),$field.wrap($wrapper),!0===config.get("adjustWidth")&&(fieldWidth=$field.outerWidth(),$field.parent().css("width",fieldWidth)),($elements_container=$("<div>").addClass(consts.getValue("CONTAINER_CLASS"))).attr("id",getContainerId()).prepend($("<ul>")),$elements_container.on("show.eac",function(){switch(config.get("list").showAnimation.type){case"slide":var animationTime=config.get("list").showAnimation.time,callback=config.get("list").showAnimation.callback;$elements_container.find("ul").slideDown(animationTime,callback);break;case"fade":animationTime=config.get("list").showAnimation.time,callback=config.get("list").showAnimation.callback,$elements_container.find("ul").fadeIn(animationTime);break;default:$elements_container.find("ul").show()}config.get("list").onShowListEvent()}).on("hide.eac",function(){switch(config.get("list").hideAnimation.type){case"slide":var animationTime=config.get("list").hideAnimation.time,callback=config.get("list").hideAnimation.callback;$elements_container.find("ul").slideUp(animationTime,callback);break;case"fade":animationTime=config.get("list").hideAnimation.time,callback=config.get("list").hideAnimation.callback,$elements_container.find("ul").fadeOut(animationTime,callback);break;default:$elements_container.find("ul").hide()}config.get("list").onHideListEvent()}).on("selectElement.eac",function(){$elements_container.find("ul li").removeClass("selected"),$elements_container.find("ul li").eq(selectedElement).addClass("selected"),config.get("list").onSelectItemEvent()}).on("loadElements.eac",function(event,listBuilders,phrase){var $item="",$listContainer=$elements_container.find("ul");$listContainer.empty().detach(),elementsList=[];for(var counter=0,builderIndex=0,listBuildersLength=listBuilders.length;builderIndex<listBuildersLength;builderIndex+=1){var listData=listBuilders[builderIndex].data;if(0!==listData.length){listBuilders[builderIndex].header!==undefined&&0<listBuilders[builderIndex].header.length&&$listContainer.append("<div class='eac-category' >"+listBuilders[builderIndex].header+"</div>");for(var i=0,listDataLength=listData.length;i<listDataLength&&counter<listBuilders[builderIndex].maxListSize;i+=1)$item=$("<li><div class='eac-item'></div></li>"),function(){var j=i,itemCounter=counter,elementsValue=listBuilders[builderIndex].getValue(listData[j]);$item.find(" > div").on("click",function(){$field.val(elementsValue).trigger("change"),selectElement(selectedElement=itemCounter),config.get("list").onClickEvent(),config.get("list").onChooseEvent()}).mouseover(function(){selectElement(selectedElement=itemCounter),config.get("list").onMouseOverEvent()}).mouseout(function(){config.get("list").onMouseOutEvent()}).html(template.build(highlight(elementsValue,phrase),listData[j]))}(),$listContainer.append($item),elementsList.push(listData[i]),counter+=1}}$elements_container.append($listContainer),config.get("list").onLoadEvent()}),$field.after($elements_container),$container=$("#"+getContainerId()),config.get("placeholder")&&$field.attr("placeholder",config.get("placeholder"))}function getContainerId(){var elementId=$field.attr("id");return elementId=consts.getValue("CONTAINER_ID")+elementId}function showContainer(){$container.trigger("show.eac")}function hideContainer(){$container.trigger("hide.eac")}function selectElement(index){$container.trigger("selectElement.eac",index)}function loadElements(list,phrase){$container.trigger("loadElements.eac",[list,phrase])}var requestDelayTimeoutId,consts=new scope.Constans,config=new scope.Configuration(options),logger=new scope.Logger,template=new scope.Template(options.template),listBuilderService=new scope.ListBuilderService(config,scope.proccess),checkParam=config.equals,$field=$input,$container="",elementsList=[],selectedElement=-1;scope.consts=consts,this.getConstants=function(){return consts},this.getConfiguration=function(){return config},this.getContainer=function(){return $container},this.getSelectedItemIndex=function(){return selectedElement},this.getItems=function(){return elementsList},this.getItemData=function(index){return elementsList.length<index||elementsList[index]===undefined?-1:elementsList[index]},this.getSelectedItemData=function(){return this.getItemData(selectedElement)},this.build=function(){prepareField()},this.init=function(){init()}},scope.eacHandles=[],scope.getHandle=function(id){return scope.eacHandles[id]},scope.inputHasId=function(input){return $(input).attr("id")!==undefined&&0<$(input).attr("id").length},scope.assignRandomId=function(input){for(var fieldId="";fieldId="eac-"+Math.floor(1e4*Math.random()),0!==$("#"+fieldId).length;);elementId=scope.consts.getValue("CONTAINER_ID")+fieldId,$(input).attr("id",fieldId)},scope.setHandle=function(handle,id){scope.eacHandles[id]=handle},scope}((EasyAutocomplete=function(scope){return scope.Template=function(options){var genericTemplates={basic:{type:"basic",method:function(element){return element},cssClass:""},description:{type:"description",fields:{description:"description"},method:function(element){return element+" - description"},cssClass:"eac-description"},iconLeft:{type:"iconLeft",fields:{icon:""},method:function(element){return element},cssClass:"eac-icon-left"},iconRight:{type:"iconRight",fields:{iconSrc:""},method:function(element){return element},cssClass:"eac-icon-right"},links:{type:"links",fields:{link:""},method:function(element){return element},cssClass:""},custom:{type:"custom",method:function(){},cssClass:""}};this.getTemplateClass=function(options){var _cssClass,emptyStringFunction=function(){return""};return options&&options.type&&options.type&&genericTemplates[options.type]?(_cssClass=genericTemplates[options.type].cssClass,function(){return _cssClass}):emptyStringFunction}(options),this.build=function(options){return options&&options.type&&options.type&&genericTemplates[options.type]?(_fields=(template=options).fields,"description"===template.type?(buildMethod=genericTemplates.description.method,"string"==typeof _fields.description?buildMethod=function(elementValue,element){return elementValue+" - <span>"+element[_fields.description]+"</span>"}:"function"==typeof _fields.description&&(buildMethod=function(elementValue,element){return elementValue+" - <span>"+_fields.description(element)+"</span>"}),buildMethod):"iconRight"===template.type?("string"==typeof _fields.iconSrc?buildMethod=function(elementValue,element){return elementValue+"<img class='eac-icon' src='"+element[_fields.iconSrc]+"' />"}:"function"==typeof _fields.iconSrc&&(buildMethod=function(elementValue,element){return elementValue+"<img class='eac-icon' src='"+_fields.iconSrc(element)+"' />"}),buildMethod):"iconLeft"===template.type?("string"==typeof _fields.iconSrc?buildMethod=function(elementValue,element){return"<img class='eac-icon' src='"+element[_fields.iconSrc]+"' />"+elementValue}:"function"==typeof _fields.iconSrc&&(buildMethod=function(elementValue,element){return"<img class='eac-icon' src='"+_fields.iconSrc(element)+"' />"+elementValue}),buildMethod):"links"===template.type?("string"==typeof _fields.link?buildMethod=function(elementValue,element){return"<a href='"+element[_fields.link]+"' >"+elementValue+"</a>"}:"function"==typeof _fields.link&&(buildMethod=function(elementValue,element){return"<a href='"+_fields.link(element)+"' >"+elementValue+"</a>"}),buildMethod):"custom"===template.type?template.method:genericTemplates.basic.method):genericTemplates.basic.method;var template,buildMethod,_fields}(options)},scope}((EasyAutocomplete=function(scope){return scope.proccess=function(config,listBuilder,phrase){function match(value,phrase){return config.get("list").match.caseSensitive||("string"==typeof value&&(value=value.toLowerCase()),phrase=phrase.toLowerCase()),!!config.get("list").match.method(value,phrase)}scope.proccess.match=match;var list=listBuilder.data;return list=function(list){return config.get("list").sort.enabled&&list.sort(config.get("list").sort.method),list}(list=function(list){return listBuilder.maxNumberOfElements!==undefined&&list.length>listBuilder.maxNumberOfElements&&(list=list.slice(0,listBuilder.maxNumberOfElements)),list}(list=function(list,phrase){var preparedList=[];if(config.get("list").match.enabled)for(var i=0,length=list.length;i<length;i+=1)match(config.get("getValue")(list[i]),phrase)&&preparedList.push(list[i]);else preparedList=list;return preparedList}(list,phrase)))},scope}((EasyAutocomplete=function(scope){return scope.ListBuilderService=function(configuration,proccessResponseData){function convertToListBuilder(category,data){var builder={};if(builder="XML"===configuration.get("dataType").toUpperCase()?function(){var listLocation,builder={};return category.xmlElementName!==undefined&&(builder.xmlElementName=category.xmlElementName),category.listLocation!==undefined?listLocation=category.listLocation:configuration.get("listLocation")!==undefined&&(listLocation=configuration.get("listLocation")),listLocation!==undefined?"string"==typeof listLocation?builder.data=$(data).find(listLocation):"function"==typeof listLocation&&(builder.data=listLocation(data)):builder.data=data,builder}():function(){var builder={};return category.listLocation!==undefined?"string"==typeof category.listLocation?builder.data=data[category.listLocation]:"function"==typeof category.listLocation&&(builder.data=category.listLocation(data)):builder.data=data,builder}(),category.header!==undefined&&(builder.header=category.header),category.maxNumberOfElements!==undefined&&(builder.maxNumberOfElements=category.maxNumberOfElements),configuration.get("list").maxNumberOfElements!==undefined&&(builder.maxListSize=configuration.get("list").maxNumberOfElements),category.getValue!==undefined)if("string"==typeof category.getValue){var defaultsGetValue=category.getValue;builder.getValue=function(element){return element[defaultsGetValue]}}else"function"==typeof category.getValue&&(builder.getValue=category.getValue);else builder.getValue=configuration.get("getValue");return builder}function convertXmlToList(builder){var simpleList=[];return builder.xmlElementName===undefined&&(builder.xmlElementName=configuration.get("xmlElementName")),$(builder.data).find(builder.xmlElementName).each(function(){simpleList.push(this)}),simpleList}this.init=function(data){var listBuilder=[],builder={};return builder.data=configuration.get("listLocation")(data),builder.getValue=configuration.get("getValue"),builder.maxListSize=configuration.get("list").maxNumberOfElements,listBuilder.push(builder),listBuilder},this.updateCategories=function(listBuilder,data){if(configuration.get("categoriesAssigned")){listBuilder=[];for(var i=0;i<configuration.get("categories").length;i+=1){var builder=convertToListBuilder(configuration.get("categories")[i],data);listBuilder.push(builder)}}return listBuilder},this.convertXml=function(listBuilder){if("XML"===configuration.get("dataType").toUpperCase())for(var i=0;i<listBuilder.length;i+=1)listBuilder[i].data=convertXmlToList(listBuilder[i]);return listBuilder},this.processData=function(listBuilder,inputPhrase){for(var i=0,length=listBuilder.length;i<length;i+=1)listBuilder[i].data=proccessResponseData(configuration,listBuilder[i],inputPhrase);return listBuilder},this.checkIfDataExists=function(listBuilders){for(var i=0,length=listBuilders.length;i<length;i+=1)if(listBuilders[i].data!==undefined&&listBuilders[i].data instanceof Array&&0<listBuilders[i].data.length)return!0;return!1}},scope}((EasyAutocomplete=function(scope){return scope.Constans=function(){var constants={CONTAINER_CLASS:"easy-autocomplete-container",CONTAINER_ID:"eac-container-",WRAPPER_CSS_CLASS:"easy-autocomplete"};this.getValue=function(propertyName){return constants[propertyName]}},scope}((EasyAutocomplete=function(scope){return scope.Logger=function(){this.error=function(message){console.log("ERROR: "+message)},this.warning=function(message){console.log("WARNING: "+message)}},scope}((EasyAutocomplete=function(scope){return scope.Configuration=function(options){function printPropertiesThatDoesntExist(consol,optionsToCheck){!function checkPropertiesIfExist(source,target){for(var property in target)source[property]===undefined&&consol.log("Property '"+property+"' does not exist in EasyAutocomplete options API."),"object"==typeof source[property]&&-1===$.inArray(property,externalObjects)&&checkPropertiesIfExist(source[property],target[property])}(defaults,optionsToCheck)}var defaults={data:"list-required",url:"list-required",dataType:"json",listLocation:function(data){return data},xmlElementName:"",getValue:function(element){return element},autocompleteOff:!0,placeholder:!1,ajaxCallback:function(){},matchResponseProperty:!1,list:{sort:{enabled:!1,method:function(a,b){return(a=defaults.getValue(a))<(b=defaults.getValue(b))?-1:b<a?1:0}},maxNumberOfElements:6,hideOnEmptyPhrase:!0,match:{enabled:!1,caseSensitive:!1,method:function(element,phrase){return-1<element.search(phrase)}},showAnimation:{type:"normal",time:400,callback:function(){}},hideAnimation:{type:"normal",time:400,callback:function(){}},onClickEvent:function(){},onSelectItemEvent:function(){},onLoadEvent:function(){},onChooseEvent:function(){},onKeyEnterEvent:function(){},onMouseOverEvent:function(){},onMouseOutEvent:function(){},onShowListEvent:function(){},onHideListEvent:function(){}},highlightPhrase:!0,theme:"",cssClasses:"",minCharNumber:0,requestDelay:0,adjustWidth:!0,ajaxSettings:{},preparePostData:function(data,inputPhrase){return data},loggerEnabled:!0,template:"",categoriesAssigned:!1,categories:[{maxNumberOfElements:4}]},externalObjects=["ajaxSettings","template"];this.get=function(propertyName){return defaults[propertyName]},this.equals=function(name,value){return!(!function(name){return defaults[name]!==undefined&&null!==defaults[name]}(name)||defaults[name]!==value)},this.checkDataUrlProperties=function(){return"list-required"!==defaults.url||"list-required"!==defaults.data},this.checkRequiredProperties=function(){for(var propertyName in defaults)if("required"===defaults[propertyName])return logger.error("Option "+propertyName+" must be defined"),!1;return!0},this.printPropertiesThatDoesntExist=function(consol,optionsToCheck){printPropertiesThatDoesntExist(consol,optionsToCheck)},function(){if("xml"===options.dataType&&(options.getValue||(options.getValue=function(element){return $(element).text()}),options.list||(options.list={}),options.list.sort||(options.list.sort={}),options.list.sort.method=function(a,b){return(a=options.getValue(a))<(b=options.getValue(b))?-1:b<a?1:0},options.list.match||(options.list.match={}),options.list.match.method=function(element,phrase){return-1<element.search(phrase)}),options.categories!==undefined&&options.categories instanceof Array){for(var categories=[],i=0,length=options.categories.length;i<length;i+=1){var category=options.categories[i];for(var property in defaults.categories[0])category[property]===undefined&&(category[property]=defaults.categories[0][property]);categories.push(category)}options.categories=categories}}(),!0===(defaults=function mergeObjects(source,target){var mergedObject=source||{};for(var propertyName in source)target[propertyName]!==undefined&&null!==target[propertyName]&&("object"!=typeof target[propertyName]||target[propertyName]instanceof Array?mergedObject[propertyName]=target[propertyName]:mergeObjects(source[propertyName],target[propertyName]));return target.data!==undefined&&null!==target.data&&"object"==typeof target.data&&(mergedObject.data=target.data),mergedObject}(defaults,options)).loggerEnabled&&printPropertiesThatDoesntExist(console,options),options.ajaxSettings!==undefined&&"object"==typeof options.ajaxSettings?defaults.ajaxSettings=options.ajaxSettings:defaults.ajaxSettings={},function(){if("list-required"!==defaults.url&&"function"!=typeof defaults.url){var defaultUrl=defaults.url;defaults.url=function(){return defaultUrl}}defaults.ajaxSettings.url!==undefined&&"function"!=typeof defaults.ajaxSettings.url&&(defaultUrl=defaults.ajaxSettings.url,defaults.ajaxSettings.url=function(){return defaultUrl});if("string"==typeof defaults.listLocation){var defaultlistLocation=defaults.listLocation;"XML"===defaults.dataType.toUpperCase()?defaults.listLocation=function(data){return $(data).find(defaultlistLocation)}:defaults.listLocation=function(data){return data[defaultlistLocation]}}if("string"==typeof defaults.getValue){var defaultsGetValue=defaults.getValue;defaults.getValue=function(element){return element[defaultsGetValue]}}options.categories!==undefined&&(defaults.categoriesAssigned=!0)}()},scope}(EasyAutocomplete||{}))||{}))||{}))||{}))||{}))||{}))||{});!function($){$.fn.easyAutocomplete=function(options){return this.each(function(){var $this=$(this),eacHandle=new EasyAutocomplete.main($this,options);EasyAutocomplete.inputHasId($this)||EasyAutocomplete.assignRandomId($this),eacHandle.init(),EasyAutocomplete.setHandle(eacHandle,$this.attr("id"))})},$.fn.getSelectedItemIndex=function(){var inputId=$(this).attr("id");return inputId!==undefined?EasyAutocomplete.getHandle(inputId).getSelectedItemIndex():-1},$.fn.getItems=function(){var inputId=$(this).attr("id");return inputId!==undefined?EasyAutocomplete.getHandle(inputId).getItems():-1},$.fn.getItemData=function(index){var inputId=$(this).attr("id");return inputId!==undefined&&-1<index?EasyAutocomplete.getHandle(inputId).getItemData(index):-1},$.fn.getSelectedItemData=function(){var inputId=$(this).attr("id");return inputId!==undefined?EasyAutocomplete.getHandle(inputId).getSelectedItemData():-1}}(jQuery);
//# sourceMappingURL=simsemsearch-min.js.map